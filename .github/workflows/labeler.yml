name: Custom Branch Labeler

on:
  pull_request_target:
    types: [opened, synchronize, reopened]
    branches: [develop, master, main]

jobs:
  label:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write

    steps:
      - name: Label PR based on branch name
        uses: actions/github-script@v7
        with:
          script: |
            const branchName = context.payload.pull_request.head.ref;
            const targetBranch = context.payload.pull_request.base.ref;
            const prNumber = context.payload.pull_request.number;
            
            let labels = [];
            
            // Check if PR is from main/master to develop (hotfix sync)
            if ((branchName === 'main' || branchName === 'master') && targetBranch === 'develop') {
              labels.push('hotfix-synced');
            }
            // Check branch name patterns
            else if (branchName.startsWith('feature/') || branchName.startsWith('feat/')) {
              labels.push('feature');
            } else if (branchName.startsWith('bugfix/') || branchName.startsWith('fix/')) {
              labels.push('bugfix');
            } else if (branchName.startsWith('refactor/')) {
              labels.push('refactor');
            } else if (branchName.startsWith('chore/')) {
              labels.push('chore');
            } else if (branchName.startsWith('hotfix/')) {
              labels.push('hotfix');
            }
            
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: prNumber,
                labels: labels
              });
              
              console.log(`Added labels: ${labels.join(', ')} to PR #${prNumber}`);
            } else {
              console.log(`No matching labels found for branch: ${branchName}`);
            }